<div class="mat-elevation-z2 form-div">
  <div class=" full-width">
    <table class="full-width table-fixed-layout table-bilan">
      <tr>
        <td>
          <autocomplete-accounting-account [(model)]="accountingBalanceSearch.accountingAccount"
            [form]="accountingBalanceForm" propertyName="accountingAccounts" label="Compte comptable">
          </autocomplete-accounting-account>
        </td>
        <td>
          <generic-input [(model)]="accountingBalanceSearch.accountingAccountNumber" label="N° de compte"
            [form]="accountingBalanceForm" propertyName="accountingAccountNumber" [isMandatory]="false" [maxLength]="3"
            [minLength]="3"></generic-input>
        </td>
        <td>
          <select-accounting-account-class [(model)]="accountingBalanceSearch.accountingClass" label="Classe comptable"
            [form]="accountingBalanceForm" propertyName="accountingClass"></select-accounting-account-class>
        </td>
        <td>
          <generic-date-range-picker [(modelStart)]="accountingBalanceSearch.startDate"
            [(modelEnd)]="accountingBalanceSearch.endDate" label="Plage de recherche" [form]="accountingBalanceForm"
            propertyNameStart="startDate" propertyNameEnd="endDate" (onDateChange)="putEndDateSameYear()">
          </generic-date-range-picker>
        </td>
        <td class="fab-td-button">
          <button mat-mini-fab color="warn" matTooltip="Rechercher" (click)="searchRecords()" class="add-button">
            <mat-icon>search</mat-icon>
          </button>
        </td>
      </tr>
    </table>
    <table mat-table matSort [dataSource]="accountingRecordDataSource" class="mat-elevation-z8 table full-width"
      *ngIf="accountingBalances">
      <ng-container matColumnDef="accountingAccountNumber">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>N° de compte</th>
        <td mat-cell *matCellDef="let element">
          {{element.accountingAccountNumber}}-{{element.accountingAccountSubNumber}}
        </td>
      </ng-container>
      <ng-container matColumnDef="accountingAccountLabel">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Libellé du compte</th>
        <td mat-cell *matCellDef="let element" class="td-label" [matTooltip]="element.accountingAccountLabel">
          {{element.accountingAccountLabel}}</td>
      </ng-container>
      <ng-container matColumnDef="debitAmount">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Débit</th>
        <td mat-cell *matCellDef="let element">
          {{element.debitAmount}}{{(element.debitAmount?" €":"")}}</td>
      </ng-container>
      <ng-container matColumnDef="creditAmount">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Crédit</th>
        <td mat-cell *matCellDef="let element">
          {{element.creditAmount}}{{(element.creditAmount?" €":"")}}</td>
      </ng-container>
      <ng-container matColumnDef="label">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Libellé</th>
        <td mat-cell *matCellDef="let element" class="td-label" [matTooltip]="element.label">{{element.label}}</td>
      </ng-container>
      <ng-container matColumnDef="echoir30">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Créances à échoir à -30 j</th>
        <td mat-cell *matCellDef="let element" class="td-label">{{element.echoir30}}{{(element.echoir30?" €":"")}}</td>
      </ng-container>
      <ng-container matColumnDef="echoir60">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Créances à échoir à -60 j</th>
        <td mat-cell *matCellDef="let element" class="td-label">{{element.echoir60}}{{(element.echoir60?" €":"")}}</td>
      </ng-container>
      <ng-container matColumnDef="echoir90">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Créances à échoir à +60 j</th>
        <td mat-cell *matCellDef="let element" class="td-label">{{element.echoir90}}{{(element.echoir90?" €":"")}}</td>
      </ng-container>
      <ng-container matColumnDef="echu30">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Créances échues à -30 j</th>
        <td mat-cell *matCellDef="let element" class="td-label">{{element.echu30}}{{(element.echu30?" €":"")}}</td>
      </ng-container>
      <ng-container matColumnDef="echu60">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Créances échues à -60 j</th>
        <td mat-cell *matCellDef="let element" class="td-label">{{element.echu60}}{{(element.echu60?" €":"")}}</td>
      </ng-container>
      <ng-container matColumnDef="echu90">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>Créances échues à +60 j</th>
        <td mat-cell *matCellDef="let element" class="td-label">{{element.echu90}}{{(element.echu90?" €":"")}}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <table mat-table [dataSource]="accumulatedDataSource" class="mat-elevation-z8 table total-table" cdkDrag
      [cdkDragFreeDragPosition]="currentUserPosition" (cdkDragEnded)="dropTotalDiv($event)" *ngIf="accountingBalances">
      <ng-container matColumnDef="label">
        <th mat-header-cell *matHeaderCellDef class="without-padding-left">
          <mat-icon (click)="restoreDefaultTotalDivPosition()" class="pointer"
            matTooltip="Restaurer la position initiale">location_on</mat-icon>
        </th>
        <td mat-cell *matCellDef="let element">{{element.label}}</td>
      </ng-container>
      <ng-container matColumnDef="debit">
        <th mat-header-cell *matHeaderCellDef>Débit</th>
        <td mat-cell *matCellDef="let element">{{element.debit}} {{(element.debit?" €":"")}}</td>
      </ng-container>
      <ng-container matColumnDef="credit">
        <th mat-header-cell *matHeaderCellDef>Crédit</th>
        <td mat-cell *matCellDef="let element">{{element.credit}} €</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumnsTotal" class="mat-header-row-small"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsTotal;"></tr>
    </table>
  </div>
</div>
<button matTooltip="Exporter" mat-fab color="accent" class="fab-button" *ngIf="accountingBalances"
  [matMenuTriggerFor]="menu">
  <mat-icon>file_download</mat-icon>
  <mat-menu #menu="matMenu" style="min-height: 0px;padding: 0;" xPosition="before">
    <button mat-menu-item (click)="exportBalance()"
      *ngIf="accountingBalanceSearch && accountingBalanceSearch.startDate && accountingBalanceSearch.endDate">Exporter
      la balance affichée
    </button>
  </mat-menu>
</button>
