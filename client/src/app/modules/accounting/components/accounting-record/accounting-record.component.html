<div class="mat-elevation-z2 form-div">
  <div class=" full-width">
    <table class="full-width table-fixed-layout">
      <tr>
        <td>
          <autocomplete-accounting-account [(model)]="accountingRecordSearch.accountingAccount"
            [filteredAccountSubNumber]="tiersToDisplay && tiersToDisplay.accountingAccountCustomer?tiersToDisplay.accountingAccountCustomer.accountingAccountSubNumber:undefined"
            [form]="accountingRecordForm" propertyName="accountingAccounts" label="Compte comptable">
          </autocomplete-accounting-account>
        </td>
        <td *ngIf="tiersToDisplay==undefined">
          <select-accounting-account-class [(model)]="accountingRecordSearch.accountingClass" label="Classe comptable"
            [form]="accountingRecordForm" propertyName="accountingClass"></select-accounting-account-class>
        </td>
        <td *ngIf="tiersToDisplay==undefined">
          <select-accounting-journal [(model)]="accountingRecordSearch.accountingJournal" label="Journal"
            [form]="accountingRecordForm" propertyName="accountingJournal">
          </select-accounting-journal>
        </td>
        <td class="toggle-td">
          <generic-toggle [(model)]="accountingRecordSearch.hideLettered" label="Cacher lettrées ?"
            [form]="accountingRecordForm" propertyName="hideLettered"></generic-toggle>
        </td>
        <td *ngIf="tiersToDisplay==undefined">
          <generic-date-range-picker [(modelStart)]="accountingRecordSearch.startDate"
            [(modelEnd)]="accountingRecordSearch.endDate" label="Plage de recherche" [form]="accountingRecordForm"
            propertyNameStart="startDate" propertyNameEnd="endDate" (onDateChange)="putEndDateSameYear()">
          </generic-date-range-picker>
        </td>
        <td class="fab-td-button">
          <button mat-mini-fab color="warn" matTooltip="Rechercher" (click)="searchRecords()" class="add-button">
            <mat-icon>search</mat-icon>
          </button>
        </td>
      </tr>
    </table>
    <sort-table [columns]="displayedColumns" [values]="accountingRecords" tableName="Ecritures" [actions]="tableAction">
    </sort-table>
    <table mat-table [dataSource]="accumulatedDataSource" class="mat-elevation-z8 table total-table" cdkDrag
      [cdkDragFreeDragPosition]="currentUserPosition" (cdkDragEnded)="dropTotalDiv($event)" *ngIf="accountingRecords">
      <ng-container matColumnDef="label">
        <th mat-header-cell *matHeaderCellDef class="without-padding-left">
          <mat-icon (click)="restoreDefaultTotalDivPosition()" class="pointer"
            matTooltip="Restaurer la position initiale">location_on</mat-icon>
        </th>
        <td mat-cell *matCellDef="let element">{{element.label}}</td>
      </ng-container>
      <ng-container matColumnDef="debit">
        <th mat-header-cell *matHeaderCellDef>Débit</th>
        <td mat-cell *matCellDef="let element">{{element.debit}} {{(element.debit?" €":"")}}</td>
      </ng-container>
      <ng-container matColumnDef="credit">
        <th mat-header-cell *matHeaderCellDef>Crédit</th>
        <td mat-cell *matCellDef="let element">{{element.credit}} €</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumnsTotal"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsTotal;"></tr>
    </table>
  </div>
</div>
<button matTooltip="Exporter" mat-fab color="accent" class="second-fab-button" [matMenuTriggerFor]="menu">
  <mat-icon>file_download</mat-icon>
  <mat-menu #menu="matMenu" style="min-height: 0px;padding: 0;" xPosition="before">
    <button mat-menu-item (click)="exportGrandLivre()"
      *ngIf="accountingRecordSearch && accountingRecordSearch.accountingClass && accountingRecordSearch.startDate && accountingRecordSearch.endDate">Exporter
      le grand livre pour la classe
      {{accountingRecordSearch.accountingClass.label}}
    </button>
    <button mat-menu-item (click)="exportJournal()"
      *ngIf="accountingRecordSearch && accountingRecordSearch.accountingJournal && accountingRecordSearch.startDate && accountingRecordSearch.endDate">Exporter
      le journal {{accountingRecordSearch.accountingJournal.label}}
    </button>
    <button mat-menu-item (click)="exportAccountingAccount()"
      *ngIf="accountingRecordSearch && accountingRecordSearch.accountingAccount && accountingRecordSearch.startDate && accountingRecordSearch.endDate">Exporter
      le compte
      {{accountingRecordSearch.accountingAccount.principalAccountingAccount.code}}{{accountingRecordSearch.accountingAccount.accountingAccountSubNumber}}
    </button>
    <button mat-menu-item (click)="exportAllGrandLivre()"
      *ngIf="accountingRecordSearch &&  accountingRecordSearch.startDate && accountingRecordSearch.endDate">Exporter
      l'ensemble du grand livre
    </button>
  </mat-menu>
</button>
<button matTooltip="Ajouter des écritures comptables" mat-fab color="accent" class="fab-button"
  *ngIf="canAddNewAccountingRecord()" (click)=" createAccountingRecords($event)"
  (auxclick)=" createAccountingRecords($event)">
  <mat-icon>add</mat-icon>
</button>
