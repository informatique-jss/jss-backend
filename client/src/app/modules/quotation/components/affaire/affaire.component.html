<ng-template #accordionTools>
  <mat-panel-description>
    <mat-icon matTooltip="Ouvrir tous les onglets" (click)="accordion!.openAll();$event.stopPropagation();"
      class="pointer">
      unfold_more_double</mat-icon>
    <mat-icon matTooltip="Fermer tous les autres onglets" (click)="accordion!.closeAll();" class="pointer">
      unfold_less_double</mat-icon>
  </mat-panel-description>
</ng-template>
<div class="mat-accordion-container full-width" *ngIf="asso && asso.affaire">
  <mat-accordion multi>
    <mat-expansion-panel expanded="false">
      <mat-expansion-panel-header>
        <mat-panel-title>Détails de l'affaire
          {{asso.affaire.denomination?asso.affaire.denomination:(asso.affaire.firstname + ' '
          +asso.affaire.lastname)}} - {{asso.affaire.address}} - {{asso.affaire.postalCode}} -
          {{asso.affaire.country.label}}
        </mat-panel-title>
        <ng-template [ngTemplateOutlet]="accordionTools"></ng-template>
      </mat-expansion-panel-header>
      <add-affaire [affaire]="asso.affaire" [editMode]="false"></add-affaire>
      <div *ngIf="asso && asso.id ">
        <autocomplete-employee [(model)]="asso.assignedTo" [form]="affaireForm" propertyName="assignedTo"
          [isMandatory]="true" [isDisabled]="false" label="Affaire assignée à"
          (onOptionSelected)="updateAssignedToForAffaire($event,asso)">
        </autocomplete-employee>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>
<div class="mat-accordion-container full-width" *ngIf="asso && asso.provisions">
  <mat-accordion multi class="mat-accordion-container">
    <mat-expansion-panel *ngFor="let provision of asso.provisions" [expanded]="!provision.id"
      [expanded]="provision.id==inputProvisionId">
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{provision.provisionType ? (provision.provisionFamilyType.label +' -
          '+provision.provisionType.label):''}}
        </mat-panel-title>
        <ng-template [ngTemplateOutlet]="accordionTools"></ng-template>
        <mat-panel-description *ngIf="editMode">
          <mat-icon matTooltip="Supprimer la prestation" (click)="deleteProvision(asso,provision)" class="pointer">
            delete</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <provision-item *ngIf="asso.affaire && asso.affaire.id" [editMode]="editMode" [provision]="provision"
        [affaire]="asso.affaire" [instanceOfCustomerOrder]="true" [isStatusOpen]="isStatusOpen">
      </provision-item>
    </mat-expansion-panel>
  </mat-accordion>
</div>
<div class="row-field-container">
  <button mat-raised-button *ngIf="editMode" (click)="createProvision(asso)" color="primary" class="mini-fab-add">
    Ajouter une prestation pour
    {{asso.affaire.denomination?asso.affaire.denomination:(asso.affaire.firstname + '
    '+asso.affaire.lastname)}}
  </button>
</div>
<button matTooltip="Sauvegarder" mat-fab color="warn" class="fab-button" *ngIf="editMode==true" (click)="saveAsso()">
  <mat-icon>save</mat-icon>
</button>
<button matTooltip="Modifier l'affaire / prestation" mat-fab color="accent" class="fab-button"
  *ngIf="editMode==false && asso" (click)="editAsso()">
  <mat-icon>edit</mat-icon>
</button>
<button matTooltip="Voir le devis" mat-fab color="accent" class="second-fab-button"
  *ngIf="editMode==false && asso && asso.quotation" (click)="displayQuotation()">
  <mat-icon>request_quote</mat-icon>
</button>
<button matTooltip="Voir la commande" mat-fab color="accent" class="second-fab-button"
  *ngIf="editMode==false && asso && asso.customerOrder" (click)="displayCustomerOrder()">
  <mat-icon>shopping_cart</mat-icon>
</button>
