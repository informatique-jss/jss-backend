<h1 *ngIf="service" mat-dialog-title>Demande des pièces manquantes - {{service.customLabel?service.customLabel:
  service.serviceType.label}}</h1>
<div mat-dialog-content *ngIf="service && service.assoServiceDocuments && service.assoServiceDocuments.length>0">
  <p>Choisissez ci-dessous la liste des pièces jointes à envoyer :</p>
  <table class="full-width">
    <tr>
      <td>
        <sort-table class="margin-bottom" (onRowClick)="selectAssoServiceDocument($event)" [columns]="displayedColumns"
          [noPaddingBottom]="true" [noMaxHeight]="true" [values]="tableValues" tableName="Documents du service"
          [refreshTable]="refreshTable.asObservable()">
        </sort-table>
      </td>
    </tr>
  </table>
  <p>Pièces demandées : </p>
  <div *ngIf="selectedAssoServiceDocument && selectedAssoServiceDocument.length>0">
    <table class="full-width">
      <tr *ngFor="let assoServiceDocument of selectedAssoServiceDocument; let index = index">
        <td style="width: 300px;">
          {{assoServiceDocument.typeDocument.label}} - {{assoServiceDocument.typeDocument.attachmentType.label}}
          {{assoServiceDocument.isMandatory? " - Obligatoire":""}}
        </td>
        <td colspan="3">
          <generic-textarea [(model)]="assoServiceDocument.formalisteComment" label="Commentaire du formaliste"
            [form]="attachmentTypeForm" [propertyName]="'formalisteComment'+index" [isMandatory]="false"
            [isDisabled]="false" [numberOfLines]="3"></generic-textarea>
        </td>
        <td style="width: 80px;">
          <button mat-raised-button color="accent" (click)="deleteAssoServiceDocument(index)"
            matTooltip="Supprimer de la sélection"><mat-icon style="margin : 0" class="pointer">
              delete</mat-icon></button>
        </td>
      </tr>
    </table>
  </div>
  <table class="full-width">
    <tr>
      <td colspan="2"><generic-textarea [(model)]="missingAttachmentQuery.comment" label="Commentaire global"
          [form]="attachmentTypeForm" propertyName="comment" [isMandatory]="false" [isDisabled]="false"
          [numberOfLines]="3"></generic-textarea>
      </td>
    </tr>
    <tr>
      <td><generic-toggle [(model)]="missingAttachmentQuery.sendToMe" label="Me l'envoyer" [form]="attachmentTypeForm"
          propertyName="sendToMe"></generic-toggle></td>
      <td><generic-toggle [(model)]="missingAttachmentQuery.copyToMe" label="Me mettre en copie"
          [form]="attachmentTypeForm" propertyName="copyToMe"></generic-toggle></td>
    </tr>
  </table>
  <p *ngIf="missingAttachmentQuery.createdDateTime">Dernier envoi le {{missingAttachmentQuery.createdDateTime|
    date:'dd/MM/yyyy HH:mm'}}</p>
</div>
<div mat-dialog-content *ngIf="!service || !service.assoServiceDocuments || service.assoServiceDocuments.length==0">
  <p>Aucun type de document attendu sur ce service</p>
</div>
<div mat-dialog-actions align="end">
  <button mat-raised-button color="accent" (click)="closeDialog()">Annuler</button>
  <button mat-raised-button color="warn" *ngIf="missingAttachmentQuery.createdDateTime"
    (click)="generateMail()">Relancer</button>
  <button mat-raised-button color="warn" *ngIf="!missingAttachmentQuery.createdDateTime"
    (click)="generateMail()">Valider</button>
</div>