<div class="mat-elevation-z2 form-div" *ngIf="provision && newDebour ">
  <form [formGroup]="debourForm">
    <div class="full-width" *ngIf="editMode">
      <table class="full-width">
        <tr>
          <td>
            <select-billing-type-debour [(model)]="newDebour.billingType" label="Type de débours/frais"
              [form]="debourForm" propertyName="billingType" [isMandatory]="true"
              [isDisabled]="!editMode"></select-billing-type-debour>
          </td>
          <td>
            <autocomplete-competent-authority [(model)]="newDebour.competentAuthority" [form]="debourForm"
              propertyName="competentAuthority" [isMandatory]="true" [isDisabled]="!editMode"
              label="Autorité compétente"></autocomplete-competent-authority>
          </td>
          <td>
            <generic-input [(model)]="newDebour.debourAmount" label="Montant" [form]="debourForm"
              propertyName="debourAmount" [isMandatory]="true" [isDisabled]="!editMode" type="number" step="0,01"
              (onFormChange)="fillInvoicedAmount()"></generic-input>
          </td>
          <td *ngIf="newDebour.billingType && newDebour.billingType.isFee">
            <generic-input [(model)]="newDebour.invoicedAmount" label="Montant facturé" [form]="debourForm"
              propertyName="invoicedAmount" [isMandatory]="false" [isDisabled]="!editMode" type="number"
              step="0,01"></generic-input>
          </td>
          <td *ngIf="newDebour.competentAuthority">
            <select-payment-types [(model)]="newDebour.paymentType" label="Mode de paiement" [form]="debourForm" 
              [filteredPaymentType]="newDebour.competentAuthority.paymentTypes" propertyName="paymentType"
              [isMandatory]="true" [isDisabled]="!editMode"></select-payment-types> 
          </td>
          <td *ngIf="newDebour.paymentType && newDebour.paymentType.id ==paymentTypeCb.id">
            <generic-datepicker [(model)]="newDebour.paymentDateTime" label="Date de paiement" [form]="debourForm"
              propertyName="paymentDateTime" [isMandatory]="true" [isDisabled]="!editMode"></generic-datepicker>
          </td>
          <td *ngIf="newDebour.paymentType && newDebour.paymentType.id ==paymentTypeCheques.id">
            <generic-input [(model)]="newDebour.checkNumber" label="Numéro du chèque" [form]="debourForm"
              propertyName="checkNumber" [isMandatory]="true" [isDisabled]="false" [maxLength]="100"></generic-input>
          </td>
          <td>
            <generic-input [(model)]="newDebour.comments" label="Commentaire" [form]="debourForm"
              propertyName="comments" [isMandatory]="false" [isDisabled]="!editMode" [maxLength]="250"></generic-input>
          </td>
          <td class="button-td">
            <button (click)="addDebour()" mat-mini-fab color="warn" class="mini-fab-add add-button">
              <mat-icon>add</mat-icon>
            </button>
          </td>
        </tr>
      </table>
    </div>
  </form>
  <sort-table [refreshTable]="refreshTable" [columns]="displayedColumns" [values]="provision.debours"
    tableName="Débours" [actions]="tableAction"></sort-table>
  <div *ngIf="provision.debours && provision.debours.length>0" class="margin-top">
    <p>Total par authorité compétente</p>
    <ul *ngFor="let competentAuthority of getCompetentAuthorities()">
      <li>{{competentAuthority.label}} : {{getTotalForCompetentAuthority(competentAuthority)}} € <span class="pointer"
          *ngIf="canAddNewInvoice()" (click)="createInvoice($event, competentAuthority)"
          (auxclick)="createInvoice($event, competentAuthority)">(créer une facture libre)</span></li>
    </ul>
  </div>
  <div class="row-field-container" *ngIf="editMode">
    <button mat-raised-button (click)="filledForInfogreffeKbis()" color="primary" class="mini-fab-add">
      Pré-remplir pour un KBis
    </button>
  </div>
</div>