<ng-template #accordionTools>
  <mat-panel-description>
    <mat-icon matTooltip="Ouvrir tous les onglets" (click)="accordion!.openAll();$event.stopPropagation();"
      class="pointer">
      unfold_more_double</mat-icon>
    <mat-icon matTooltip="Fermer tous les autres onglets" (click)="accordion!.closeAll();" class="pointer">
      unfold_less_double</mat-icon>
  </mat-panel-description>
</ng-template>
<div class="mat-elevation-z2 form-div">
  <form>
    <div class="mat-accordion-container full-width">
      <div class="row-field-container">
        <mat-form-field class="full-width">
          <input matInput (keyup)="applyFilter($event.target)" placeholder="Rechercher une affaire">
        </mat-form-field>
        <button [disabled]="editMode==false" (click)="createProvision()" mat-mini-fab color="warn" class="mini-fab-add">
          <mat-icon>add</mat-icon>
        </button>
      </div>
      <fieldset [disabled]="editMode==false" class="fieldset-no-border">
        <mat-accordion multi>
          <mat-expansion-panel *ngFor="let provision of filteredProvisions; let index = index;">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <span *ngIf="provision.affaire!=null">Affaire <span *ngIf="!provision.affaire.isIndividual && provision.affaire.denomination!=null
                   && provision.affaire.denomination!=undefined">{{provision.affaire.denomination}}</span><span *ngIf="provision.affaire.isIndividual
                   && provision.affaire.firstname!=null
                   && provision.affaire.firstname!=undefined  && provision.affaire.lastname!=null
                   && provision.affaire.lastname!=undefined">{{provision.affaire.firstname}}
                    {{provision.affaire.lastname}}</span>
                  - Service {{provision.provisionType?provision.provisionType.label:""}}
                </span>
              </mat-panel-title>
              <ng-template [ngTemplateOutlet]="accordionTools"></ng-template>
              <mat-panel-description>
                <mat-icon *ngIf="provision.id==null || provision.id==undefined" (click)="deleteProvision(index)"
                  class="pointer">delete</mat-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <affaire [affaire]="provision.affaire" [editMode]="editMode"></affaire>
            <provision-item [editMode]="editMode" [provision]="provision"></provision-item>
          </mat-expansion-panel>
        </mat-accordion>
      </fieldset>
    </div>
  </form>
</div>
