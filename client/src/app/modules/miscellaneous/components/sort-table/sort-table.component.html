<div class="wrapper-div" *ngIf="values && columns">
  <table mat-table matTableExporter matSort [dataSource]="dataSource" class="mat-elevation-z8 table full-width"
    #exporter="matTableExporter">
    <ng-container [matColumnDef]="column.id" *ngFor="let column of columns">
      <th mat-header-cell mat-sort-header *matHeaderCellDef>
        {{getColumnLabel(column)}}
      </th>
      <ng-container *ngIf="!column.displayAsGrade && !column.displayAsEmployee">
        <td mat-cell *matCellDef="let element" [matTooltip]="column.isShrinkColumn?getColumnValue(column,element):''"
          [ngClass]="{'td-label':column.isShrinkColumn}">
          <span [ngClass]="{'color-warn':getIsElementWarnColor(column,element)}" class="nowrap">{{getColumnValue(column,
            element)}}
            <mat-icon color="accent" [matTooltip]="column.actionTooltip" color="accent"
              class="pointer column-content-icon" (click)="openColumnLink($event, column, element)"
              (auxclick)="openColumnLink($event, column, element)" *ngIf=" column.actionLinkFunction && getColumnLink(column,
              element)">
              {{column.actionIcon}}
            </mat-icon>
          </span>
        </td>
      </ng-container>
      <ng-container *ngIf="column.displayAsGrade">
        <td mat-cell *matCellDef="let element">
          <grade [grade]="getColumnValue(column, element)"></grade>
        </td>
      </ng-container>
      <ng-container>
        <td mat-cell *matCellDef="let element">
          <div class="select-with-avatar" *ngIf=" column.displayAsEmployee && getColumnValue(column, element)">
            <avatar class="avatar" [size]="20" [employee]="getColumnValue(column, element)"></avatar>
            <span>{{getColumnValue(column, element).firstname}}
              {{getColumnValue(column, element).lastname}}</span>
          </div>
        </td>
      </ng-container>
    </ng-container>
    <ng-container matColumnDef="actions" *ngIf="internalActions">
      <th mat-header-cell mat-sort-header *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element">
        <ng-container *ngFor="let action of actions">
          <mat-icon color="accent" [matTooltip]="action.actionName" *ngIf="action.display && action.actionClick"
            color="accent" class="pointer  column-content-icon"
            (click)="actionTrigger(action, element,$event)">{{action.actionIcon}}
          </mat-icon>
          <mat-icon color="accent" [matTooltip]="action.actionName"
            *ngIf="action.display &&  getActionLink(action, element)" (click)="openActionLink($event, action, element)"
            (auxclick)="openActionLink($event, action, element)" color="accent" class="pointer column-content-icon">
            {{action.actionIcon}}
          </mat-icon>
        </ng-container>
      </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="getDisplayedColumns(); sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: getDisplayedColumns();" (click)="rowClicked(row)" [ngClass]="{'pointer':onRowClick && onRowClick.observers && onRowClick.observers.length>0,
      'selected-mat-row':idRowSelected && row.id && idRowSelected==row.id,
      'color-warn':true}">
    </tr>
  </table>
  <mat-icon color="accent" class="export-icon pointer" matTooltip="Exporter en Excel"
    (click)="exporter.exportTable('csv', {fileName:tableName, sheet: tableName, delimiter:';', bookSST :true})">file_download
  </mat-icon>
  <mat-icon color="accent" class="column-icon pointer" matTooltip="Afficher/masquer des colonnes"
    [matMenuTriggerFor]="colors_menu">
    view_column
  </mat-icon>
  <mat-menu #colors_menu="matMenu">
    <button mat-menu-item (click)="selectColumnAll( $event)">
      Afficher toutes les colonnes
    </button>
    <button mat-menu-item (click)="unselectColumnAll( $event)">
      Cacher toutes les colonnes
    </button>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="selectColumn(column, $event)" *ngFor="let column of columns">
      <mat-icon color="accent" color="primary" *ngIf="!column.display">check_box_outline_blank</mat-icon>
      <mat-icon color="accent" color="primary" *ngIf="column.display">check_box</mat-icon>
      {{getColumnLabel(column)}}
    </button>
  </mat-menu>
  <div *ngIf="values && displayTotalLines" class="column-icon-number"
    [matTooltip]="values.length+' ligne'+(values.length>1?'s':'')">
    <chips-status [value]="values.length+''"></chips-status>
  </div>
</div>
