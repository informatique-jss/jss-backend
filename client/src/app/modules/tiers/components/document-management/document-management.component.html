<form [formGroup]="documentManagementForm" *ngIf="tiers">
  <div class="mat-accordion-container full-width">
    <fieldset [disabled]="editMode==false" class="fieldset-no-border">
      <mat-accordion>
        <mat-expansion-panel expanded>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Justificatif de parution
            </mat-panel-title>
          </mat-expansion-panel-header>
          <table class="full-width">
            <tr>
              <td>
                <h4>Destinataire de d'adressage</h4>
                <mat-checkbox formControlName="publicationRecipientTypeAffaire" class="checkbox-margin"
                  [(ngModel)]="publicationDocument.isRecipientAffaire">Affaire
                </mat-checkbox>
                <mat-checkbox formControlName="publicationRecipientTypeClient" class="checkbox-margin"
                  [(ngModel)]="publicationDocument.isRecipientClient">Client
                </mat-checkbox>
              </td>
              <td>
                <h4>Type d'adressage</h4>
                <mat-checkbox formControlName="publicationMailingTypePaper" class="checkbox-margin"
                  [(ngModel)]="publicationDocument.isMailingPaper">Papier</mat-checkbox>
                <button matTooltip="Modifier les adresses postales par défaut"
                  *ngIf="publicationDocument.isMailingPaper && (publicationDocument.isRecipientAffaire || publicationDocument.isRecipientClient)"
                  mat-icon-button color="accent"
                  (click)="overridePublicationAffaireAddress=true;overridePublicationClientAddress=true">
                  <mat-icon>edit</mat-icon>
                </button>
                <mat-checkbox formControlName="publicationMailingTypePdf" class="checkbox-margin"
                  [(ngModel)]="publicationDocument.isMailingPdf">PDF</mat-checkbox>
                <button matTooltip="Modifier les adresses mail par défaut"
                  *ngIf="publicationDocument.isMailingPdf && (publicationDocument.isRecipientAffaire || publicationDocument.isRecipientClient)"
                  mat-icon-button color="accent"
                  (click)="overridePublicationAffaireMail=true;overridePublicationClientMail=true">
                  <mat-icon>edit</mat-icon>
                </button>
              </td>
              <td *ngIf="publicationDocument.isMailingPaper && publicationDocument.isRecipientAffaire">
                <mat-form-field class="mat-form-field-padding">
                  <mat-label>Nombre d'exemplaire Affaire</mat-label>
                  <input matInput formControlName="publicationNumberMailingAffaire"
                    [(ngModel)]="publicationDocument.numberMailingAffaire" autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td *ngIf="publicationDocument.isMailingPaper && publicationDocument.isRecipientClient">
                <mat-form-field class="mat-form-field-padding">
                  <mat-label>Nombre d'exemplaire Client</mat-label>
                  <input matInput formControlName="publicationNumberMailingClient"
                    [(ngModel)]="publicationDocument.numberMailingClient" autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
            </tr>
            <tr
              *ngIf="publicationDocument.isMailingPaper && publicationDocument.isRecipientAffaire && overridePublicationAffaireAddress">
              <td>
                <mat-form-field class="full-width">
                  <mat-label>Autres destinataires pour l'affaire</mat-label>
                  <input matInput formControlName="publicationAffaireRecipient"
                    [(ngModel)]="publicationDocument.affaireRecipient" autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td colspan="2">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses pour l'affaire</mat-label>
                  <input matInput formControlName="publicationAffaireAddress"
                    [(ngModel)]="publicationDocument.affaireAddress" autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td [hidden]="!editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overridePublicationAffaireAddress=false ; publicationDocument.affaireRecipient='' ; publicationDocument.affaireAddress=''">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
            <tr
              *ngIf="publicationDocument.isMailingPdf && publicationDocument.isRecipientAffaire && overridePublicationAffaireMail">
              <td colspan="3">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses mail pour l'affaire</mat-label>
                  <mat-chip-list #chipListMails>
                    <mat-chip *ngFor="let mail of publicationDocument.mailsAffaire"
                      (removed)="removeMailAffaire(mail,publicationDocument)">
                      {{mail.mail}}
                      <button matChipRemove *ngIf="editMode">
                        <mat-icon>cancel</mat-icon>
                      </button>
                      <mat-icon matChipRemove *ngIf="editMode==false" (click)="prepareMail(mail)">mail</mat-icon>
                    </mat-chip>
                    <input placeholder="Saisir un mail" #mailInput formControlName="publicationMailsAffaire"
                      [matChipInputFor]="chipListMails" [matChipInputSeparatorKeyCodes]="SEPARATOR_KEY_CODES"
                      (matChipInputTokenEnd)="addMailAffaire($event,publicationDocument,'publicationMailsAffaire')">
                    <button *ngIf="  !editMode" matSuffix mat-icon-button
                      (click)="overridePublicationAffaireMail=false ; removeAllMailAffaire(publicationDocument)">
                      <mat-icon>close</mat-icon>
                    </button>
                  </mat-chip-list>
                </mat-form-field>
              </td>
              <td [hidden]="  !editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overridePublicationAffaireMail=false ; removeAllMailAffaire(publicationDocument)">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
            <tr
              *ngIf="publicationDocument.isMailingPaper && publicationDocument.isRecipientClient && overridePublicationClientAddress">
              <td>
                <mat-form-field class="full-width">
                  <mat-label>Autres destinataires pour le client</mat-label>
                  <input matInput formControlName="publicationClientRecipient"
                    [(ngModel)]="publicationDocument.clientRecipient" autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td colspan="3">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses pour le client</mat-label>
                  <input matInput formControlName="publicationClientAddress"
                    [(ngModel)]="publicationDocument.clientAddress" autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td [hidden]="  !editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overridePublicationClientAddress=false ; publicationDocument.clientAddress='' ; publicationDocument.clientRecipient=''">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
            <tr
              *ngIf="publicationDocument.isMailingPdf && publicationDocument.isRecipientClient && overridePublicationClientMail">
              <td [hidden]="!overridePublicationClientMail || !publicationDocument.isRecipientClient" colspan="3">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses mail pour le client</mat-label>
                  <mat-chip-list #chipListMails>
                    <mat-chip *ngFor="let mail of publicationDocument.mailsClient"
                      (removed)="removeMailClient(mail,publicationDocument)">
                      {{mail.mail}}
                      <button matChipRemove *ngIf="editMode">
                        <mat-icon>cancel</mat-icon>
                      </button>
                      <mat-icon matChipRemove *ngIf="editMode==false" (click)="prepareMail(mail)">mail</mat-icon>
                    </mat-chip>
                    <input placeholder="Saisir un mail" #mailInput formControlName="publicationMailsClient"
                      [matChipInputFor]="chipListMails" [matChipInputSeparatorKeyCodes]="SEPARATOR_KEY_CODES"
                      (matChipInputTokenEnd)="addMailClient($event,publicationDocument,'publicationMailsClient')">
                  </mat-chip-list>
                </mat-form-field>
              </td>
              <td [hidden]="!editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overridePublicationClientMail=false ;removeAllMailClient(publicationDocument)">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
          </table>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              CFE
            </mat-panel-title>
          </mat-expansion-panel-header>
          <table class="full-width">
            <tr>
              <td>
                <h4>Destinataire de d'adressage</h4>
                <mat-checkbox formControlName="kbisRecipientTypeAffaire" class="checkbox-margin"
                  [(ngModel)]="kbisDocument.isRecipientAffaire">Affaire
                </mat-checkbox>
                <mat-checkbox formControlName="kbisRecipientTypeClient" class="checkbox-margin"
                  [(ngModel)]="kbisDocument.isRecipientClient">Client
                </mat-checkbox>
              </td>
              <td>
                <h4>Type d'adressage</h4>
                <mat-checkbox formControlName="kbisMailingTypePaper" class="checkbox-margin"
                  [(ngModel)]="kbisDocument.isMailingPaper">Papier</mat-checkbox>
                <button matTooltip="Modifier les adresses postales par défaut"
                  *ngIf="kbisDocument.isMailingPaper && (kbisDocument.isRecipientAffaire || kbisDocument.isRecipientClient)"
                  mat-icon-button color="accent" (click)="overrideCfeAffaireAddress=true;overrideCfeClientAddress=true">
                  <mat-icon>edit</mat-icon>
                </button>
                <mat-checkbox formControlName="kbisMailingTypePdf" class="checkbox-margin"
                  [(ngModel)]="kbisDocument.isMailingPdf">PDF</mat-checkbox>
                <button matTooltip="Modifier les adresses mail par défaut"
                  *ngIf="kbisDocument.isMailingPdf && (kbisDocument.isRecipientAffaire || kbisDocument.isRecipientClient)"
                  mat-icon-button color="accent" (click)="overrideCfeAffaireMail=true;overrideCfeClientMail=true">
                  <mat-icon>edit</mat-icon>
                </button>
              </td>
            </tr>
            <tr *ngIf="kbisDocument.isMailingPaper && kbisDocument.isRecipientAffaire && overrideCfeAffaireAddress">
              <td>
                <mat-form-field class="full-width">
                  <mat-label>Autres destinataires pour l'affaire</mat-label>
                  <input matInput formControlName="kbisAffaireRecipient" [(ngModel)]="kbisDocument.affaireRecipient"
                    autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td colspan="2">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses pour l'affaire</mat-label>
                  <input matInput formControlName="kbisAffaireAddress" [(ngModel)]="kbisDocument.affaireAddress"
                    autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td [hidden]="!editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overrideCfeAffaireAddress=false ; kbisDocument.affaireRecipient='' ; kbisDocument.affaireAddress=''">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
            <tr *ngIf="kbisDocument.isMailingPdf && kbisDocument.isRecipientAffaire && overrideCfeAffaireMail">
              <td colspan="3">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses mail pour l'affaire</mat-label>
                  <mat-chip-list #chipListMails>
                    <mat-chip *ngFor="let mail of kbisDocument.mailsAffaire"
                      (removed)="removeMailAffaire(mail,kbisDocument)">
                      {{mail.mail}}
                      <button matChipRemove *ngIf="editMode">
                        <mat-icon>cancel</mat-icon>
                      </button>
                      <mat-icon matChipRemove *ngIf="editMode==false" (click)="prepareMail(mail)">mail</mat-icon>
                    </mat-chip>
                    <input placeholder="Saisir un mail" #mailInput formControlName="kbisMailsAffaire"
                      [matChipInputFor]="chipListMails" [matChipInputSeparatorKeyCodes]="SEPARATOR_KEY_CODES"
                      (matChipInputTokenEnd)="addMailAffaire($event,kbisDocument,'kbisMailsAffaire')">
                    <button *ngIf="  !editMode" matSuffix mat-icon-button
                      (click)="overrideCfeAffaireMail=false ; removeAllMailAffaire(kbisDocument)">
                      <mat-icon>close</mat-icon>
                    </button>
                  </mat-chip-list>
                </mat-form-field>
              </td>
              <td [hidden]="  !editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overrideCfeAffaireMail=false ; removeAllMailAffaire(kbisDocument)">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
            <tr *ngIf="kbisDocument.isMailingPaper && kbisDocument.isRecipientClient && overrideCfeClientAddress">
              <td>
                <mat-form-field class="full-width">
                  <mat-label>Autres destinataires pour le client</mat-label>
                  <input matInput formControlName="kbisClientRecipient" [(ngModel)]="kbisDocument.clientRecipient"
                    autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td colspan="3">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses pour le client</mat-label>
                  <input matInput formControlName="kbisClientAddress" [(ngModel)]="kbisDocument.clientAddress"
                    autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td [hidden]="  !editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overrideCfeClientAddress=false ; kbisDocument.clientAddress='' ; kbisDocument.clientRecipient=''">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
            <tr *ngIf="kbisDocument.isMailingPdf && kbisDocument.isRecipientClient && overrideCfeClientMail">
              <td [hidden]="!overrideCfeClientMail || !kbisDocument.isRecipientClient" colspan="3">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses mail pour le client</mat-label>
                  <mat-chip-list #chipListMails>
                    <mat-chip *ngFor="let mail of kbisDocument.mailsClient"
                      (removed)="removeMailClient(mail,kbisDocument)">
                      {{mail.mail}}
                      <button matChipRemove *ngIf="editMode">
                        <mat-icon>cancel</mat-icon>
                      </button>
                      <mat-icon matChipRemove *ngIf="editMode==false" (click)="prepareMail(mail)">mail</mat-icon>
                    </mat-chip>
                    <input placeholder="Saisir un mail" #mailInput formControlName="kbisMailsClient"
                      [matChipInputFor]="chipListMails" [matChipInputSeparatorKeyCodes]="SEPARATOR_KEY_CODES"
                      (matChipInputTokenEnd)="addMailClient($event,kbisDocument,'kbisMailsClient')">
                  </mat-chip-list>
                </mat-form-field>
              </td>
              <td [hidden]="!editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overrideCfeClientMail=false ;removeAllMailClient(kbisDocument)">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
          </table>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Kbis
            </mat-panel-title>
          </mat-expansion-panel-header>
          <table class="full-width">
            <tr>
              <td>
                <h4>Destinataire de d'adressage</h4>
                <mat-checkbox formControlName="kbisRecipientTypeAffaire" class="checkbox-margin"
                  [(ngModel)]="kbisDocument.isRecipientAffaire">Affaire
                </mat-checkbox>
                <mat-checkbox formControlName="kbisRecipientTypeClient" class="checkbox-margin"
                  [(ngModel)]="kbisDocument.isRecipientClient">Client
                </mat-checkbox>
              </td>
              <td>
                <h4>Type d'adressage</h4>
                <mat-checkbox formControlName="kbisMailingTypePaper" class="checkbox-margin"
                  [(ngModel)]="kbisDocument.isMailingPaper">Papier</mat-checkbox>
                <button matTooltip="Modifier les adresses postales par défaut"
                  *ngIf="kbisDocument.isMailingPaper && (kbisDocument.isRecipientAffaire || kbisDocument.isRecipientClient)"
                  mat-icon-button color="accent"
                  (click)="overrideKbisAffaireAddress=true;overrideKbisClientAddress=true">
                  <mat-icon>edit</mat-icon>
                </button>
                <mat-checkbox formControlName="kbisMailingTypePdf" class="checkbox-margin"
                  [(ngModel)]="kbisDocument.isMailingPdf">PDF</mat-checkbox>
                <button matTooltip="Modifier les adresses mail par défaut"
                  *ngIf="kbisDocument.isMailingPdf && (kbisDocument.isRecipientAffaire || kbisDocument.isRecipientClient)"
                  mat-icon-button color="accent" (click)="overrideKbisAffaireMail=true;overrideKbisClientMail=true">
                  <mat-icon>edit</mat-icon>
                </button>
              </td>
            </tr>
            <tr *ngIf="kbisDocument.isMailingPaper && kbisDocument.isRecipientAffaire && overrideKbisAffaireAddress">
              <td>
                <mat-form-field class="full-width">
                  <mat-label>Autres destinataires pour l'affaire</mat-label>
                  <input matInput formControlName="kbisAffaireRecipient" [(ngModel)]="kbisDocument.affaireRecipient"
                    autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td colspan="2">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses pour l'affaire</mat-label>
                  <input matInput formControlName="kbisAffaireAddress" [(ngModel)]="kbisDocument.affaireAddress"
                    autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td [hidden]="!editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overrideKbisAffaireAddress=false ; kbisDocument.affaireRecipient='' ; kbisDocument.affaireAddress=''">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
            <tr *ngIf="kbisDocument.isMailingPdf && kbisDocument.isRecipientAffaire && overrideKbisAffaireMail">
              <td colspan="3">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses mail pour l'affaire</mat-label>
                  <mat-chip-list #chipListMails>
                    <mat-chip *ngFor="let mail of kbisDocument.mailsAffaire"
                      (removed)="removeMailAffaire(mail,kbisDocument)">
                      {{mail.mail}}
                      <button matChipRemove *ngIf="editMode">
                        <mat-icon>cancel</mat-icon>
                      </button>
                      <mat-icon matChipRemove *ngIf="editMode==false" (click)="prepareMail(mail)">mail</mat-icon>
                    </mat-chip>
                    <input placeholder="Saisir un mail" #mailInput formControlName="kbisMailsAffaire"
                      [matChipInputFor]="chipListMails" [matChipInputSeparatorKeyCodes]="SEPARATOR_KEY_CODES"
                      (matChipInputTokenEnd)="addMailAffaire($event,kbisDocument,'kbisMailsAffaire')">
                    <button *ngIf="  !editMode" matSuffix mat-icon-button
                      (click)="overrideKbisAffaireMail=false ; removeAllMailAffaire(kbisDocument)">
                      <mat-icon>close</mat-icon>
                    </button>
                  </mat-chip-list>
                </mat-form-field>
              </td>
              <td [hidden]="  !editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overrideKbisAffaireMail=false ; removeAllMailAffaire(kbisDocument)">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
            <tr *ngIf="kbisDocument.isMailingPaper && kbisDocument.isRecipientClient && overrideKbisClientAddress">
              <td>
                <mat-form-field class="full-width">
                  <mat-label>Autres destinataires pour le client</mat-label>
                  <input matInput formControlName="kbisClientRecipient" [(ngModel)]="kbisDocument.clientRecipient"
                    autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td colspan="3">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses pour le client</mat-label>
                  <input matInput formControlName="kbisClientAddress" [(ngModel)]="kbisDocument.clientAddress"
                    autocomplete="do-not-autofill">
                </mat-form-field>
              </td>
              <td [hidden]="  !editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overrideKbisClientAddress=false ; kbisDocument.clientAddress='' ; kbisDocument.clientRecipient=''">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
            <tr *ngIf="kbisDocument.isMailingPdf && kbisDocument.isRecipientClient && overrideKbisClientMail">
              <td [hidden]="!overrideKbisClientMail || !kbisDocument.isRecipientClient" colspan="3">
                <mat-form-field class="full-width">
                  <mat-label>Autres adresses mail pour le client</mat-label>
                  <mat-chip-list #chipListMails>
                    <mat-chip *ngFor="let mail of kbisDocument.mailsClient"
                      (removed)="removeMailClient(mail,kbisDocument)">
                      {{mail.mail}}
                      <button matChipRemove *ngIf="editMode">
                        <mat-icon>cancel</mat-icon>
                      </button>
                      <mat-icon matChipRemove *ngIf="editMode==false" (click)="prepareMail(mail)">mail</mat-icon>
                    </mat-chip>
                    <input placeholder="Saisir un mail" #mailInput formControlName="kbisMailsClient"
                      [matChipInputFor]="chipListMails" [matChipInputSeparatorKeyCodes]="SEPARATOR_KEY_CODES"
                      (matChipInputTokenEnd)="addMailClient($event,kbisDocument,'kbisMailsClient')">
                  </mat-chip-list>
                </mat-form-field>
              </td>
              <td [hidden]="!editMode" align="end"><button mat-icon-button color="accent"
                  (click)="overrideKbisClientMail=false ;removeAllMailClient(kbisDocument)">
                  <mat-icon>close</mat-icon>
                </button>
              </td>
            </tr>
          </table>
        </mat-expansion-panel>
      </mat-accordion>
    </fieldset>
  </div>
</form>
