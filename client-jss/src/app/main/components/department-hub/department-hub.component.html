<div class="container">
  <ng-container *ngIf="selectedEntityType">
    <div class="bg-container pt-0">
      <div class="w-100 justify-content-between">
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-12">
              <div class="w-100 my-3 d-flex flex-column flex-md-row justify-content-between mt-0">
                <div class="row w-100 gx-2">
                  <div class="col-12 col-md-8 position-relative mb-2 mb-md-0">
                    <generic-input class="w-100" [(model)]="searchText" label="Rechercher" [form]="hubForm"
                      propertyName="searchText" [isMandatory]="false" [isDisabled]="false" [isDisplayLabel]="false"
                      (onFormChange)="searchForPosts()" [icon]="'search'">
                    </generic-input>

                    <button *ngIf="searchText"
                      class="btn btn-link clear-btn position-absolute top-50 end-0 translate-middle-y me-2"
                      (click)="clearSearch()" type="button">
                      <i class="bi bi-x-lg"></i>
                    </button>
                  </div>

                  <div class="col-12 col-md-4">
                    <select-publishing-department class="w-100" [(model)]="selectedPublishingDepartment"
                      placeholder="Département" [form]="hubForm" propertyName="selectedPublishingDepartment"
                      [isMandatory]="false" (onFormChange)="searchForPosts()" [isDisabled]="false">
                    </select-publishing-department>
                  </div>
                </div>
              </div>

              <div class="row p-0">
                <div *ngIf="!postsByEntityType[selectedEntityType.id] " class="pb-3">
                  <div class="panel-loader">
                    <div class="skeleton skeleton-header"></div>
                    <div class="skeleton skeleton-line"></div>
                    <div class="skeleton skeleton-line"></div>
                    <div class="skeleton skeleton-line short"></div>
                    <div class="skeleton skeleton-block"></div>
                  </div>
                </div>

                <div
                  *ngIf="postsByEntityType[selectedEntityType.id] && postsByEntityType[selectedEntityType.id].length>0 && !searchText"
                  class="row p-0 fixed-size-img-posts">
                  <div *ngFor="let post of postsByEntityType[selectedEntityType.id]" class="col-12 mb-2">
                    <article class="blog-style2 card mb-4">
                      <div class="feature-image">
                        <div class="image-frame image-hover-style-1">
                          <a [routerLink]=' "/post/" + post.slug'> <img *ngIf="post.media" class="lazyload"
                              [src]="post.media.urlMediumLarge!=null ? post.media.urlMediumLarge : post.media.urlFull"
                              [alt]="post.media.alt_text" class="w-100"></a>
                        </div>
                      </div>
                      <div class="card-body  d-md-flex align-items-center">
                        <div class="card-flex-content">
                          <div class="d-flex flex-wrap gap-1">
                            <ng-container *ngIf="post.departments!=null && post.departments.length>0">
                              <a *ngFor="let department of post.departments  " style="cursor: pointer;"
                                [routerLink]='"/post/department/" + department.code'
                                class="badge badge-category bg-info rounded-pill px-2">{{department.name}}</a>
                            </ng-container>
                            <a *ngFor="let cat of post.jssCategories" [routerLink]=' "/post/category/" + cat.slug'
                              class="badge bg-info badge-category rounded-pill px-2">{{ cat.name }}</a>
                            <bookmark *ngIf="currentUser" [post]="post"></bookmark>
                          </div>
                          <h4>
                            <span role="button" tabindex="0" class="pointer card-text-truncate"
                              [routerLink]=' "/post/" + post.slug'> <img *ngIf="post.isPremium" class="pe-0"
                                src="/assets/images/premium-icon.svg"><img *ngIf="post.isHidePremium" class="ms-1 pe-0"
                                src="/assets/images/premium-icon.svg">
                              {{post.titleText}}</span>
                          </h4>
                          <div class="row d-flex justify-content-end">
                            <div class="col-auto"> <span class="date-info fs-9 float-lg-end">
                                <span>Publié le {{post.date | date:'EEEE d MMMM'}}</span>
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </article>
                    <hr>
                  </div>
                </div>

                <div *ngIf="searchResults && searchResults.length>0 && searchText && searchText.length>2"
                  class="row p-0 fixed-size-img-posts">
                  <div *ngFor="let post of searchResults" class="col-12 mb-2">
                    <article class="blog-style2 card mb-4">
                      <div class="feature-image">
                        <div class="image-frame image-hover-style-1">
                          <a [routerLink]=' "/post/" + post.slug'> <img *ngIf="post.media" class="lazyload"
                              [src]="post.media.urlMediumLarge!=null ? post.media.urlMediumLarge : post.media.urlFull"
                              [alt]="post.media.alt_text" class="w-100"></a>
                        </div>
                      </div>
                      <div class="card-body  d-md-flex align-items-center">
                        <div class="card-flex-content">
                          <div class="d-flex flex-wrap gap-1">
                            <a *ngFor="let cat of post.jssCategories" [routerLink]=' "/post/category/" + cat.slug'
                              class="badge bg-info badge-category rounded-pill px-2">{{ cat.name }}</a>

                            <bookmark *ngIf="currentUser" [post]="post"></bookmark>
                          </div>
                          <h4>
                            <span role="button" tabindex="0" class="pointer card-text-truncate"
                              [routerLink]=' "/post/" + post.slug'> <img *ngIf="post.isPremium" class="pe-0"
                                src="/assets/images/premium-icon.svg"><img *ngIf="post.isHidePremium" class="ms-1 pe-0"
                                src="/assets/images/premium-icon.svg">
                              {{post.titleText}}</span>
                          </h4>
                        </div>
                      </div>
                    </article>
                    <hr>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-12">
              <div class="card mb-3 border border-light p-3">
                <div class="wrapper">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="section-title-block d-flex pb-3">
                        <h3 class="section-widget-title">Tags liés</h3>

                      </div>
                    </div>
                  </div>
                  <ul class="tag-cloud list-inline">
                    <li *ngFor="let tag of tagsByEntityType.slice(0,8)" class="list-inline-item pb-1">
                      <button class="btn bg-light text-secondary bg-hover-danger text-hover-white bg-hover-secondary
                        text-hover-white" [routerLink]=' "/post/tag/" + tag.slug'>{{tag.name}}</button>
                    </li>
                  </ul>
                </div>
              </div>

              <div class="mb-3 border border-light card">
                <div class="wrapper p-3">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="section-title-block d-flex">
                        <h3 class="section-widget-title">Les plus vus</h3>
                      </div>
                    </div>
                  </div>
                  <div class="tab-content" id="tab-content">
                    <div *ngFor="let post of mostSeenPostsByEntityType.slice(0,5); let index = index"
                      class="row align-items-center my-3">
                      <div class="col-auto digits pe-2">
                        {{index+1}}.
                      </div>
                      <div class="col counter-post-item ps-2">
                        <a [routerLink]=' "/post/" + post.slug' class="title-most-seen">{{post.titleText}}</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="border border-light card p-3 mb-3 bg-secondary">
                <div class="wrapper text-white">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="section-title-block d-flex ">
                        <h3 class="text-white">Au cœur de l'actualité !</h3>
                      </div>
                    </div>
                  </div>
                  <p>Infos locales, analyses et enquêtes : restez informé(e) sans limite.</p>
                  <div class="row align-items-center">
                    <div class="btn btn-yellow">S'abonner
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <nav *ngIf="totalPage > 1" class="mt-4">
            <ul class="pagination justify-content-center">
              <li class="page-item" *ngFor="let p of pages" [class.active]="p === page">
                <a class="page-link" [routerLink]="[p]">{{ p + 1 }}</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </ng-container>
</div>