<div class="row">
  <div class="col-12">
    <div class="card  " [ngClass]="className">
      <div class="card-header justify-content-between align-items-center" *ngIf="title">
        <h5 class="card-title">{{title}}</h5>
      </div>
      <div class="card-body p-0">
        <div class="card-header justify-content-between">
          <div>
            <div class="app-search">
              <input type="search" class="form-control" (input)="table.setGlobalFilter($any($event.target).value)"
                placeholder="Rechercher...">
              <lucide-angular [img]="LucideSearch" class="app-search-icon text-muted" />
            </div>
          </div>
          <div class="d-flex align-items-center gap-2">

            <!--div class="app-search ">
              <select [ngModel]="table.getColumn('status')?.getFilterValue() || 'All'"
                (ngModelChange)="table.setColumnFilters([{ id: 'status', value: $event }])"
                class="form-select form-control my-1 my-md-0">
                <option value="All">Status</option>
                <option value="Bearish">Bearish</option>
                <option value="Bullish">Bullish</option>
              </select>

            </div-->
            <!--  TODO -->


            <div>
              <select class="form-select form-control my-1 my-md-0" [ngModel]="table.getState().pagination.pageSize"
                (ngModelChange)="setPageSize($event)">
                <option [ngValue]="5">5</option>
                <option [ngValue]="10">10</option>
                <option [ngValue]="15">15</option>
                <option [ngValue]="20">20</option>
              </select>
            </div>
            <button class="btn btn-default btn-icon" (click)="exportToExcel()"> <lucide-angular [img]="LucideDownload"
                class="app-search-icon text-muted" /> </button>
          </div>
        </div>
        <div [ngClass]="['table-responsive', className]">
          <table class="table table-hover table-responsive table-custom table-centered table-select w-100 mb-0">

            @if (showHeaders) {
            <thead class="bg-light align-middle bg-opacity-25 thead-sm">
              @for (headerGroup of table.getHeaderGroups(); track headerGroup) {
              <tr class="text-uppercase fs-xxs">
                @for (header of headerGroup.headers; track header.id) {
                <th (click)="header.column.toggleSorting()"
                  [style.cursor]="header.column.getCanSort() ? 'pointer' : 'default'" style="user-select: none">
                  <div class="d-flex align-items-center">
                    @if (header.column.id === 'select') {
                    <input type="checkbox" class="form-check-input form-check-input-light fs-14"
                      [checked]="table.getIsAllPageRowsSelected()" [indeterminate]="table.getIsSomePageRowsSelected()"
                      (change)="table.toggleAllPageRowsSelected($any($event.target).checked)" />
                    } @else {
                    <ng-container *flexRender="header.column.columnDef.header; props: header.getContext()">
                      {{ header.column.columnDef.header }}
                    </ng-container>
                    }

                    @if (header.column.getCanSort()) {
                    @switch (header.column.getIsSorted()) {
                    @case ('asc') {
                    <ng-icon name="tablerArrowUp" class="ms-1" />
                    }
                    @case ('desc') {
                    <ng-icon name="tablerArrowDown" class="ms-1" />
                    }
                    }
                    }
                  </div>
                </th>
                }
              </tr>
              }
            </thead>
            }

            <tbody>
              @if (table.getRowModel().rows.length === 0) {
              <tr>
                <td [attr.colspan]="columns.length" class="text-center py-3 text-muted">
                  {{ emptyMessage }}
                </td>
              </tr>
              }

              @for (row of table.getRowModel().rows; track row.id) {
              <tr>
                @for (cell of row.getVisibleCells(); track cell.id) {
                <td>
                  @if (cell.column.id === 'select') {
                  <input type="checkbox" class="form-check-input form-check-input-light fs-14"
                    [checked]="cell.row.getIsSelected()"
                    (change)="cell.row.toggleSelected($any($event.target).checked)" />
                  }
                  @if (cell.column.id === 'actions') {
                  <div class="d-flex  gap-1 align-items-center">
                    <!--button class="btn btn-light btn-icon btn-sm rounded-circle">
                                                <ng-icon
                                                    name="tablerEye" class="fs-lg"/>
                                            </button-->
                    <!--TODO : actions-->
                  </div>

                  } @else {
                  <ng-container *flexRender="cell.column.columnDef.cell; props: cell.getContext(); let cell">
                    {{ cell }}
                  </ng-container>

                  }

                </td>
                }
              </tr>
              }
            </tbody>
          </table>
        </div>
        <div class="card-footer border-0">
          <tanstack-table-pagination [totalItems]="table.getFilteredRowModel().rows.length"
            [start]="table.getState().pagination.pageIndex * table.getState().pagination.pageSize + 1"
            [end]="Math.min(((table.getState().pagination.pageIndex + 1) * table.getState().pagination.pageSize > table.getFilteredRowModel().rows.length ? table.getFilteredRowModel().rows.length : (table.getState().pagination.pageIndex + 1) * table.getState().pagination.pageSize))"
            (previousPage)="this.table.previousPage();" [canPreviousPage]="table.getCanPreviousPage()"
            [pageCount]="table.getPageCount()" [pageIndex]="table.getState().pagination.pageIndex"
            (setPageIndex)="table.setPageIndex($event)" (nextPage)="this.table.nextPage()" [showInfo]="true"
            [canNextPage]="table.getCanNextPage()"></tanstack-table-pagination>
        </div>

      </div>
    </div>
  </div>
</div>